From 0000000000000000000000000000000000000000 Mon Sep 17 00:00:00 2001
From: Jonathan Leitschuh <jlleitschuh@wpi.edu>
Date: Wed, 11 Jun 2014 15:44:46 -0400
Subject: [PATCH 0090/6262] Adds Java debug script and updates the Ant file to
 run with the plugins [artf2570]

Change-Id: Ic6a8ed99c4ea5e53a076f6301b8d66f48bf1ac03
---
 .../src/main/resources/java-zip/ant/build.xml | 57 ++++++++++---------
 .../resources/java-zip/ant/debugjavaprogram   |  5 ++
 2 files changed, 35 insertions(+), 27 deletions(-)
 create mode 100644 eclipse-plugins/edu.wpi.first.wpilib.plugins.java/src/main/resources/java-zip/ant/debugjavaprogram

diff --git a/eclipse-plugins/edu.wpi.first.wpilib.plugins.java/src/main/resources/java-zip/ant/build.xml b/eclipse-plugins/edu.wpi.first.wpilib.plugins.java/src/main/resources/java-zip/ant/build.xml
index 50818dcd8b9272d2e158f0937d3f421a339193ae..7be9de61c17754fcfe1f3d5fa78907884dc8abf6 100644
--- a/eclipse-plugins/edu.wpi.first.wpilib.plugins.java/src/main/resources/java-zip/ant/build.xml
+++ b/eclipse-plugins/edu.wpi.first.wpilib.plugins.java/src/main/resources/java-zip/ant/build.xml
@@ -30,14 +30,14 @@
     <echo>[athena-compile] Compiling ${src.dir} with classpath=${classpath} to ${build.dir}</echo>
     
     <javac srcdir="${src.dir}"
-	   destdir="${build.dir}"
-	   includeAntRuntime="no"
-	   includeJavaRuntime="no"
-	   classpath="${classpath}"
-	   target="1.7"
-	   source="1.7"
+     destdir="${build.dir}"
+     includeAntRuntime="no"
+     includeJavaRuntime="no"
+     classpath="${classpath}"
+     target="1.7"
+     source="1.7"
      compiler="javac1.7"
-	   debug="true">
+     debug="true">
     </javac>
   </target>
   
@@ -46,32 +46,32 @@
     <mkdir dir="${dist.dir}" />
     <mkdir dir="${build.jars}" />
 
-	<echo>[athena-jar] Copying jars from ${classpath} to ${build.jars}.</echo>
-	<copy todir="${build.jars}" flatten="true">
-	  <path>
-		<pathelement path="${classpath}"/>
-	  </path>
-	</copy>
-	
+  <echo>[athena-jar] Copying jars from ${classpath} to ${build.jars}.</echo>
+  <copy todir="${build.jars}" flatten="true">
+    <path>
+    <pathelement path="${classpath}"/>
+    </path>
+  </copy>
+  
     <jar destfile="${dist.jar}" update="false">
       <manifest>
-    	<attribute name="Main-Class" value="edu.wpi.first.wpilibj.RobotBase"/>
-    	<attribute name="Robot-Class" value="${main}"/>
-    	<attribute name="Class-Path" value="."/>
+      <attribute name="Main-Class" value="edu.wpi.first.wpilibj.RobotBase"/>
+      <attribute name="Robot-Class" value="${main}"/>
+      <attribute name="Class-Path" value="."/>
       </manifest>
-		
+    
       <fileset dir="${build.dir}" includes="**/*.class"/>
       
-	  <zipgroupfileset dir="${build.jars}">
-	  	<include name="**/*.jar" />
-	  </zipgroupfileset>
+    <zipgroupfileset dir="${build.jars}">
+      <include name="**/*.jar" />
+    </zipgroupfileset>
     </jar>
   </target>
 
   <target name="deploy" depends="get-target-ip,jar" description="Deploy the jar and start the program running.">
     <echo>[athena-deploy] Copying code over.</echo>
     <scp file="${dist.jar}" todir="${username}@${target}:${deploy.dir}"
-	 password="${password}" trust="true"/>
+   password="${password}" trust="true"/>
     <scp file="${wpilib.ant.dir}/runjavaprogram" todir="${username}@${target}:${deploy.dir}"
    password="${password}" trust="true"/>
     <echo>[athena-deploy] Starting program.</echo>
@@ -85,12 +85,15 @@
   <target name="debug-deploy" depends="get-target-ip,jar" description="Deploy the jar and start the program running in debug mode.">
     <echo>[athena-debug-deploy] Copying code over.</echo>
     <scp file="${dist.jar}" todir="${username}@${target}:${deploy.dir}"
-	 password="${password}" trust="true"/>
+   password="${password}" trust="true"/>
+   <echo>[athena-debug-deploy] Copying Debug Script Over.</echo>
+   <scp file="${wpilib.ant.dir}/debugjavaprogram" todir="${username}@${target}:${deploy.dir}"
+   password="${password}" trust="true"/>
     <echo>[athena-debug-deploy] Starting program.</echo>
     <sshexec host="${target}"
-	     username="${username}"
-	     password="${password}"
-	     trust="true"
-	     command="${deploy.debug.command}"/>
+       username="${username}"
+       password="${password}"
+       trust="true"
+       command="chmod a+x debug*program; ${deploy.debug.command}"/>
   </target>
 </project>
diff --git a/eclipse-plugins/edu.wpi.first.wpilib.plugins.java/src/main/resources/java-zip/ant/debugjavaprogram b/eclipse-plugins/edu.wpi.first.wpilib.plugins.java/src/main/resources/java-zip/ant/debugjavaprogram
new file mode 100644
index 0000000000000000000000000000000000000000..d76b9ca8717ab97813588f25c7d5ea405b107d0d
--- /dev/null
+++ b/eclipse-plugins/edu.wpi.first.wpilib.plugins.java/src/main/resources/java-zip/ant/debugjavaprogram
@@ -0,0 +1,5 @@
+#. ./.profile
+killall java
+sleep 1
+/usr/local/frc/JRE/bin/java -XX:+UsePerfData -agentlib:jdwp=transport=dt_socket,address=8348,server=y,suspend=y -jar FRCUserProgram.jar
+#nohup java -Djna.library.path=$LD_LIBRARY_PATH -Xmx32M -agentlib:jdwp=transport=dt_socket,address=8348,server=y,suspend=y -jar FRCUserProgram.jar
\ No newline at end of file
