From 0000000000000000000000000000000000000000 Mon Sep 17 00:00:00 2001
From: Patrick Plenefisch <simonpatp@gmail.com>
Date: Thu, 25 Sep 2014 20:50:01 -0400
Subject: [PATCH 0370/6262] JNI should ignore -lfrc and installing the new ld
 scripts

Change-Id: I6b5d2767a0148bd01246c6a205ba32d30440b3d5
---
 CMakeLists.txt                       | 1 +
 hal/CMakeLists.txt                   | 2 +-
 wpilibj/wpilibJavaJNI/CMakeLists.txt | 1 +
 3 files changed, 3 insertions(+), 1 deletion(-)

diff --git a/CMakeLists.txt b/CMakeLists.txt
index eadd0a44bd14f20ee6787f95e487c53a961e0f00..193c3ff5247fd17b3eb65cd4d8749e27a2f7650e 100644
--- a/CMakeLists.txt
+++ b/CMakeLists.txt
@@ -6,6 +6,7 @@ SET(CMAKE_SKIP_BUILD_RPATH TRUE)
 
 file(GLOB_RECURSE NI_LIBS ni-libraries/*.so*)
 list(REMOVE_ITEM NI_LIBS ${CMAKE_CURRENT_SOURCE_DIR}/ni-libraries/libwpi.so ${CMAKE_CURRENT_SOURCE_DIR}/ni-libraries/libwpi_2015.so)
+SET(WPI_LD_LIBS ${CMAKE_CURRENT_SOURCE_DIR}/ni-libraries/libwpi.so ${CMAKE_CURRENT_SOURCE_DIR}/ni-libraries/libwpi_2015.so)
 get_filename_component(WPILIB_INCLUDES wpilibc/wpilibC++/include REALPATH)
 get_filename_component(HAL_API_INCLUDES hal/include REALPATH)
 get_filename_component(NWT_API_INCLUDES networktables/cpp/include REALPATH)
diff --git a/hal/CMakeLists.txt b/hal/CMakeLists.txt
index c783a8b20bdced05019cf838444673aab882f894..9954a758333dea6d415a134d78004fb4f155a115 100644
--- a/hal/CMakeLists.txt
+++ b/hal/CMakeLists.txt
@@ -6,7 +6,7 @@ include_directories(lib/Athena lib/Athena/FRC_FPGA_ChipObject include)
 add_library(HALAthena STATIC ${SRC_FILES})
 target_link_libraries(HALAthena ${NI_LIBS})
 INSTALL(TARGETS HALAthena ARCHIVE DESTINATION lib COMPONENT lib)
-INSTALL(FILES ${NI_LIBS} DESTINATION lib COMPONENT ni_lib)
+INSTALL(FILES ${NI_LIBS} ${WPI_LD_LIBS} DESTINATION lib COMPONENT ni_lib)
 INSTALL(DIRECTORY include DESTINATION ${CMAKE_INSTALL_PREFIX} COMPONENT headers)
 # lib/ c m gcc_s ld-linux
 # usr/lib 
diff --git a/wpilibj/wpilibJavaJNI/CMakeLists.txt b/wpilibj/wpilibJavaJNI/CMakeLists.txt
index 9a10f9ae8d7027ababe609f2f6354262f3ec9c08..d44eb519cd96da7a0e47d5859350ac8347076e96 100644
--- a/wpilibj/wpilibJavaJNI/CMakeLists.txt
+++ b/wpilibj/wpilibJavaJNI/CMakeLists.txt
@@ -4,6 +4,7 @@ project(WPILibJavaJNI)
 set(CMAKE_CXX_FLAGS "${CMAKE_CXX_FLAGS} -Wformat=2 -Wextra -Wno-unused-parameter -fPIC -Werror")
 SET(CMAKE_SKIP_BUILD_RPATH TRUE)
 file(GLOB_RECURSE NI_LIBS ../../ni-libraries/*.so)
+list(REMOVE_ITEM NI_LIBS ${CMAKE_CURRENT_SOURCE_DIR}/../../ni-libraries/libwpi.so ${CMAKE_CURRENT_SOURCE_DIR}/../../ni-libraries/libwpi_2015.so)
 get_filename_component(HAL_API_INCLUDES ../../hal/include REALPATH)
 ## depends on libFRC_NetComm, halAthena Hal incl, wpilibJava (jar)
 # this file requires embeddedJDKHome to be set
