From 0000000000000000000000000000000000000000 Mon Sep 17 00:00:00 2001
From: Omar Zrien <OZrien@crosstheroadelectronics.com>
Date: Sun, 24 Aug 2014 19:57:40 -0400
Subject: [PATCH 0315/6262] fix for Artifact artf3431 : Solenoids initialize to
 random/arbitrary stat

Change-Id: I0bdcf073637a47a9e6864f6d561cc812a1d5b021
---
 hal/lib/Athena/ctre/CtreCanNode.h | 5 +++++
 hal/lib/Athena/ctre/PCM.cpp       | 3 +--
 2 files changed, 6 insertions(+), 2 deletions(-)

diff --git a/hal/lib/Athena/ctre/CtreCanNode.h b/hal/lib/Athena/ctre/CtreCanNode.h
index bf5a4a53533dedc632f1420ad72daefbdb44488e..ead88b43e0f7bfdfb8f57daa33a8e0ba1c03f84c 100644
--- a/hal/lib/Athena/ctre/CtreCanNode.h
+++ b/hal/lib/Athena/ctre/CtreCanNode.h
@@ -88,6 +88,11 @@ private:
 			uint32_t arbId;
 			uint8_t toSend[8];
 			uint32_t periodMs;
+			txJob_t() : arbId(0),periodMs(0)
+			{
+				for(int i=0;i<sizeof(toSend);++i)
+					toSend[i] = 0;
+			}
 	};
 
 	class rxEvent_t{
diff --git a/hal/lib/Athena/ctre/PCM.cpp b/hal/lib/Athena/ctre/PCM.cpp
index dd21e79adcb1ba91b0c48c90ec99320cf886e40b..0120ab5813f0db7e8e43fa5c0fbbd4d6f375b4ff 100644
--- a/hal/lib/Athena/ctre/PCM.cpp
+++ b/hal/lib/Athena/ctre/PCM.cpp
@@ -101,8 +101,7 @@ PCM::PCM(UINT8 deviceNumber): CtreCanNode(deviceNumber)
 	RegisterRx(STATUS_DEBUG | deviceNumber );
 	RegisterTx(CONTROL_1 | deviceNumber, kCANPeriod);
 	/* enable close loop */
-	CtreCanNode::txTask<PcmControl_t> toFill = GetTx<PcmControl_t>(CONTROL_1 | GetDeviceNumber());
-	toFill->closedLoopEnable = 1;
+	SetClosedLoopControl(1);
 }
 /* PCM D'tor
  */
