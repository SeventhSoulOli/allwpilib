From 33d9466d50620c09d44cc261a89a7e97130793c6 Mon Sep 17 00:00:00 2001
From: PJ Reiniger <pj.reiniger@gmail.com>
Date: Wed, 4 May 2022 00:25:03 -0400
Subject: [PATCH 28/36] Add missing raw_ostream functions

---
 llvm/include/llvm/Support/raw_ostream.h | 4 +++-
 llvm/lib/Support/raw_ostream.cpp        | 3 +++
 2 files changed, 6 insertions(+), 1 deletion(-)

diff --git a/llvm/include/llvm/Support/raw_ostream.h b/llvm/include/llvm/Support/raw_ostream.h
index 81c65e117782..b1aa670549c0 100644
--- a/llvm/include/llvm/Support/raw_ostream.h
+++ b/llvm/include/llvm/Support/raw_ostream.h
@@ -321,6 +321,9 @@ private:
   /// \invariant { Size > 0 }
   virtual void write_impl(const char *Ptr, size_t Size) = 0;
 
+  // An out of line virtual method to provide a home for the class vtable.
+  virtual void handle();
+
   /// Return the current position within the stream, not counting the bytes
   /// currently in the buffer.
   virtual uint64_t current_pos() const = 0;
@@ -405,7 +408,6 @@ class raw_fd_ostream : public raw_pwrite_stream {
   int FD;
   bool ShouldClose;
   bool SupportsSeeking = false;
-  mutable Optional<bool> HasColors;
 
 #ifdef _WIN32
   /// True if this fd refers to a Windows console device. Mintty and other
diff --git a/llvm/lib/Support/raw_ostream.cpp b/llvm/lib/Support/raw_ostream.cpp
index 5051ff4e8d06..941240c832dd 100644
--- a/llvm/lib/Support/raw_ostream.cpp
+++ b/llvm/lib/Support/raw_ostream.cpp
@@ -90,6 +90,9 @@ raw_ostream::~raw_ostream() {
     delete [] OutBufStart;
 }
 
+// An out of line virtual method to provide a home for the class vtable.
+void raw_ostream::handle() {}
+
 size_t raw_ostream::preferred_buffer_size() const {
   // BUFSIZ is intended to be a reasonable default.
   return BUFSIZ;
-- 
2.20.1.windows.1

