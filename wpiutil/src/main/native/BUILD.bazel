load("@rules_cc//cc:defs.bzl", "cc_library")
load("//shared/bazel/rules/gen:gen-resources.bzl", "generate_resources")

generate_resources(
    name = "generate-resources",
    namespace = "dlt",
    prefix = "DLT",
    resource_files = glob(["resources/*"]),
)

filegroup(
    name = "native-srcs",
    srcs = select({
        "@bazel_tools//src/conditions:windows": glob([
            "windows/*.cpp",
            "windows/*.h",
        ]),
        "@rules_bzlmodrio_toolchains//constraints/combined:is_unix": glob(["unix/*.cpp"]),
    }),
)

cc_library(
    name = "wpiutil.static",
    srcs = glob(
        ["cpp/**"],
        exclude = ["cpp/jni/**"],
    ) + [
        ":generate-resources",
        ":native-srcs",
        "//wpiutil/src/main/native/thirdparty/fmtlib:fmtlib-srcs",
        "//wpiutil/src/main/native/thirdparty/llvm:llvm-srcs",
        "//wpiutil/src/main/native/thirdparty/memory:memory-srcs",
        "//wpiutil/src/main/native/thirdparty/mpack:mpack-srcs",
        "//wpiutil/src/main/native/thirdparty/protobuf:protobuf-srcs",
    ],
    hdrs = glob(["include/**/*"]),
    includes = ["include"],
    strip_include_prefix = "include",
    visibility = ["//visibility:public"],
    deps = [
        "//wpiutil/src/main/native/thirdparty/expected:expected-headers",
        "//wpiutil/src/main/native/thirdparty/fmtlib:fmtlib-headers",
        "//wpiutil/src/main/native/thirdparty/json:json-headers",
        "//wpiutil/src/main/native/thirdparty/llvm:llvm-headers",
        "//wpiutil/src/main/native/thirdparty/memory:memory-headers",
        "//wpiutil/src/main/native/thirdparty/mpack:mpack-headers",
        "//wpiutil/src/main/native/thirdparty/protobuf:protobuf-headers",
        "//wpiutil/src/main/native/thirdparty/sigslot:sigslot-headers",
    ] + select({
        "@rules_bzlmodrio_toolchains//constraints/is_roborio:roborio": ["@bzlmodrio-ni//libraries/cpp/ni:shared"],
        "//conditions:default": [],
    }),
)
