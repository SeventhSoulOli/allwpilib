# Build steps

parameters:
  gradleOptions: ''
  buildOptions: ''
  artifactName: ''

steps:
  - task: Gradle@2
    condition: and(succeeded(), not(startsWith(variables['Build.SourceBranch'], 'refs/tags/v')))
    inputs:
      workingDirectory: ''
      gradleWrapperFile: 'gradlew'
      gradleOptions: '-Xmx3072m ${{ parameters.gradleOptions }}'
      jdkVersionOption: '1.11'
      publishJUnitResults: true
      testResultsFiles: '**/TEST-*.xml'
      tasks: 'build'
      options: '-PbuildServer ${{ parameters.buildOptions }}'

  - task: Gradle@2
    condition: and(succeeded(), startsWith(variables['Build.SourceBranch'], 'refs/tags/v'))
    inputs:
      workingDirectory: ''
      gradleWrapperFile: 'gradlew'
      gradleOptions: '-Xmx3072m ${{ parameters.gradleOptions }}'
      jdkVersionOption: '1.11'
      publishJUnitResults: true
      testResultsFiles: '**/TEST-*.xml'
      tasks: 'build'
      options: '-PreleaseMode -PbuildServer ${{ parameters.buildOptions }}'

  - task: PublishPipelineArtifact@0
    inputs:
      artifactName: ${{ parameters.artifactName }}
      targetPath: 'build/allOutputs'
